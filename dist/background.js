const c="http://localhost:4000";let s=!1;function i(){s||(console.log("PromptPilot background service worker initializing..."),s=!0,console.log("PromptPilot background service worker initialized"))}chrome.runtime.onMessage.addListener((e,r,o)=>(i(),console.log("Background received message:",e.type),e.type==="IMPROVE_PROMPT"?(a(e.text),o({status:"processing"}),!0):e.type==="OPEN_POPUP"?(o({status:"received"}),!0):e.type==="CAPTURED_TEXT"?(o({status:"received"}),!0):(o({status:"unhandled_message_type"}),!0)));async function a(e){try{console.log("Sending prompt to backend for improvement");const r=await fetch(`${c}/improve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e})});if(!r.ok)throw new Error(`Server returned ${r.status}: ${r.statusText}`);const o=await r.json();console.log("Received improved prompt from backend");try{chrome.runtime.sendMessage({type:"IMPROVED_TEXT",text:o.improvedPrompt},t=>{const n=chrome.runtime.lastError;n&&console.error("Error sending improved text - popup may be closed:",n.message)})}catch(t){console.error("Error sending improved text to popup:",t)}}catch(r){console.error("Error improving prompt:",r);try{chrome.runtime.sendMessage({type:"ERROR",error:r instanceof Error?r.message:"Unknown error occurred"},o=>{const t=chrome.runtime.lastError;t&&console.error("Error sending error message - popup may be closed:",t.message)})}catch(o){console.error("Error sending error to popup:",o)}}}i();chrome.runtime.onConnect.addListener(e=>{console.log("Connection established with",e.name),e.onMessage.addListener(r=>{console.log("Received port message:",r)}),e.onDisconnect.addListener(()=>{console.log("Port disconnected:",e.name)})});
