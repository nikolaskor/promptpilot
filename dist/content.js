let o=null,e=null,s=!1;function i(){s||(console.log("PromptPilot content script initializing..."),document.addEventListener("focusin",d),chrome.runtime.onMessage.addListener((n,t,r)=>(console.log("Content script received message:",n.type),n.type==="GET_SELECTED_TEXT"?(a(),r({status:"text_requested"})):r({status:"unhandled_message_type"}),!0)),s=!0,console.log("PromptPilot content script initialized"))}function d(n){const t=n.target;t.tagName==="TEXTAREA"||t.getAttribute("contenteditable")==="true"?(o=t,u(t)):(l(),o=null)}function u(n){l(),e=document.createElement("button"),e.textContent="✏️ Improve",e.style.position="absolute",e.style.zIndex="10000",e.style.padding="4px 8px",e.style.backgroundColor="#4285f4",e.style.color="white",e.style.border="none",e.style.borderRadius="4px",e.style.fontSize="12px",e.style.cursor="pointer",e.style.boxShadow="0 1px 3px rgba(0, 0, 0, 0.3)";const t=n.getBoundingClientRect();e.style.top=`${window.scrollY+t.top-30}px`,e.style.left=`${window.scrollX+t.right-100}px`,e.addEventListener("click",c),document.body.appendChild(e)}function l(){e&&e.parentNode&&(e.removeEventListener("click",c),e.parentNode.removeChild(e),e=null)}function c(){if(o){a();try{chrome.runtime.sendMessage({type:"OPEN_POPUP"},n=>{const t=chrome.runtime.lastError;t&&console.log("Error opening popup:",t.message)})}catch(n){console.log("Error sending open popup message:",n)}}}function a(){if(o){let n="";o.tagName==="TEXTAREA"?n=o.value:o.getAttribute("contenteditable")==="true"&&(n=o.innerText);try{chrome.runtime.sendMessage({type:"CAPTURED_TEXT",text:n},t=>{const r=chrome.runtime.lastError;r&&console.log("Error sending captured text:",r.message)})}catch(t){console.log("Error sending captured text message:",t)}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i();
